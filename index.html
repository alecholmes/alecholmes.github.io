<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Alec Holmes | Software Engineer | San Francisco</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <style>

body {
  padding-top: 50px;
}
.starter-template {
  padding: 40px 15px;
  text-align: center;
}

.bar rect {
  fill: rgba(70 ,130 ,180, 0.95);
  shape-rendering: crispEdges;
}

.bar text {
  fill: #fff;
}

.axis path, .axis line {
  fill: none;
  stroke: rgba(70 ,130 ,180, 0.95);
  shape-rendering: crispEdges;
}

.axis text {
  fill: #d6e0e7;
}

.effort line {
  fill: none;
  /*stroke: #000;*/
  stroke: #d6e0e7;
  stroke-width: 2;
  shape-rendering: crispEdges;
}

.effort text {
  /*font: 14px sans-serif;*/
  fill: #d6e0e7;
}

#segment {
  text-align: center;
  color: #d6e0e7;
}

body {
  background: url('bridge.jpg') no-repeat 50% 100% fixed; 
  background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  -webkit-background-size: cover;
}

  </style>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Alec Holmes</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="resume.html">Resume</a></li>
            <li><a href="https://www.facebook.com/alec.holmes">Facebook</a><li>
            <li><a href="https://twitter.com/_alec310">Twitter</a><li>
            <li><a href="https://www.linkedin.com/in/holmesalec">LinkedIn</a><li>
            <li><a href="mailto:alecholmes@gmail.com">Email</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
      <div id="histogram"></div>

      <h4 id="segment">Hawk Hill</h4>

    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
<script src="http://d3js.org/d3.v2.min.js?2.10.0"></script>
<script>
// Heavily inspired by http://bl.ocks.org/mbostock/3048166
function drawHistogram(values) {
  var dataMin = d3.min(values)
  var dataMax = d3.max(values)
  var dataRange = dataMax - dataMin + 1
  
  // Formatters for counts and times (converting numbers to Dates).
  var formatCount = d3.format(",.0f"),
      formatTime = d3.time.format("%M:%S"),
      formatSeconds = function(d) { return formatTime(new Date(2012, 0, 1, 0, 0, d)); };
  
  var margin = {top: 10, right: 30, bottom: 50, left: 30},
      width = parseInt(d3.select("#histogram").style("width")) - margin.left - margin.right,
      height = $( window ).height() - $( ".navbar" ).height() - $( "#segment" ).outerHeight(true) - margin.top - margin.bottom - 10;
  
  var x = d3.scale.linear()
      .domain([dataMin, dataMax])
      .range([0, width]);
  
  // Generate a histogram using twenty uniformly-spaced bins.
  var data = d3.layout.histogram()
      .bins(15)
      (values);
  
  var y = d3.scale.linear()
      .domain([0, d3.max(data, function(d) { return d.y; })])
      .range([height, 0]);
  
  var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom")
      .tickValues(data.map(function(d) { return d.x; }))
      .tickFormat(formatSeconds);
  
  var svg = d3.select("#histogram")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  
  var bar = svg.selectAll(".bar")
      .data(data)
    .enter().append("g")
      .attr("class", "bar")
      .attr("transform", function(d) { return "translate(" + x(d.x) + "," + y(d.y) + ")"; });
  
  bar.append("rect")
      .attr("x", 1)
      .attr("width", width / data.length - 1)
      .attr("height", function(d) { return height - y(d.y); });
  
  var recentEffortsYOffset = function(i) { return i * height / 2 / 3; }
  
  var recentEfforts = svg.selectAll(".effort")
      .data(values.slice(0, 3))
    .enter().append("g")
      .attr("class", "effort")
      .attr("transform", function(d, i) { return "translate(" + x(d) + "," + recentEffortsYOffset(i) + ")"; });// TODO: 50
  
  recentEfforts.append("line")
      .attr("class", "effort")
      .attr("x2", 0)
      .attr("y2", function(d, i) { return height - recentEffortsYOffset(i); })
  
  recentEfforts.append("text")
      .attr("dy", ".75em")
      .attr("dx", "4")
      .attr("text-anchor", "top")
      .text(function(d) { return formatSeconds(d); });
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
      .selectAll("text")  
              .style("text-anchor", "end")
              .attr("dx", "-.8em")
              .attr("dy", ".15em")
              .attr("transform", function(d) {
                  return "rotate(-65)" 
                  });
}

// some old defaults
// var values = [
//     608, 654, 565, 545, 601, 526, 548, 542, 562, 565, 513, 583, 518, 539, 498, 532, 494, 542, 569, 559, 577, 583, 541, 545, 583, 581, 546, 545  , 571, 557, 511, 524, 552, 494, 536, 521, 521, 524, 553, 540, 533, 505, 492, 569, 554, 591, 532, 524, 520, 510, 532, 517, 599, 524, 528,   538, 501, 491, 513, 487, 496, 517, 485, 557, 487, 535, 499, 528, 537, 514, 526, 512, 507, 587, 487, 543, 533, 563, 591, 544, 583, 533,   521, 575, 543, 586, 517, 535, 515, 509, 566, 491, 495, 621, 561, 534, 514, 573, 571, 571, 503, 498, 538, 518, 618, 608, 551, 561, 508,   525, 560, 543, 596, 521, 610, 544, 603, 557, 552, 549, 560, 538, 559, 547, 487, 564, 514, 563, 513, 537, 495, 526, 570, 513, 564, 548,   542, 583, 582, 517, 533, 517, 586, 515, 591, 566, 497, 593, 513, 554, 504, 533, 490, 526, 624, 510, 534, 483, 545
//   ]
// drawHistogram(values);

$( window ).resize(function() {
  d3.select("#histogram").selectAll("*").remove();
  drawHistogram(values);
});


function loadSegmentTimes() {
  $.getJSON( "http://app.alecholmes.com/v1/athletes/471686/segments/229781/efforts", function( data ) {
    // mutating global state. yay!
    values = data.map(function(d) { return d.elapsed_time; })
    drawHistogram(values);
  })
}

loadSegmentTimes()

</script>
